import{parse as t,translateX as e,translateY as i,scaleX as n,scaleY as r,multiply as o}from"rematrix";import s,{createContext as a,Component as p,Children as l,cloneElement as c}from"react";import u from"prop-types";var d=function(t){return"number"==typeof t},f=function(t){return"[object Object]"===Object.prototype.toString.call(t)},h=function(t){return Array.prototype.slice.apply(t)};function g(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return e.forEach(function(e){if(e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}),t}var m,v=function(t,e,i){return t+(e-t)*i},y={noWobble:{stiffness:200,damping:26},gentle:{stiffness:120,damping:14},veryGentle:{stiffness:130,damping:17},wobbly:{stiffness:180,damping:12},stiff:{stiffness:260,damping:26}},S=function(t){return f(t)?t:Object.keys(y).indexOf(t)>-1?y[t]:{}};"undefined"!=typeof window&&(m=window.requestAnimationFrame);var _=m=m||function(t){window.setTimeout(t,1e3/60)},E=Date.now(),I="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()-E};function w(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}var C=function(){};C.prototype.run=function(){var t=this;_(function(){t.springSystem.loop(I())})};var b=function(){this.position=0,this.velocity=0},A=0,O=function(t){this._id="s"+A++,this._springSystem=t,this.listeners=[],this._startValue=0,this._currentState=new b,this._displacementFromRestThreshold=.001,this._endValue=0,this._overshootClampingEnabled=!1,this._previousState=new b,this._restSpeedThreshold=.001,this._tempState=new b,this._timeAccumulator=0,this._wasAtRest=!0,this._cachedSpringConfig={}};O.prototype.getId=function(){return this._id},O.prototype.destroy=function(){this.listeners=[],this._springSystem.deregisterSpring(this)},O.prototype.setSpringConfig=function(t){return this._springConfig=t,this},O.prototype.getCurrentValue=function(){return this._currentState.position},O.prototype.getDisplacementDistanceForState=function(t){return Math.abs(this._endValue-t.position)},O.prototype.setEndValue=function(t){if(t===this._endValue)return this;if(this.prevEndValue=t,this._endValue===t&&this.isAtRest())return this;this._startValue=this.getCurrentValue(),this._endValue=t,this._springSystem.activateSpring(this.getId());for(var e=0,i=this.listeners.length;e<i;e++){var n=this.listeners[e].onSpringEndStateChange;n&&n(this)}return this},O.prototype.setVelocity=function(t){return t===this._currentState.velocity?this:(this._currentState.velocity=t,this._springSystem.activateSpring(this.getId()),this)},O.prototype.setCurrentValue=function(t){this._startValue=t,this._currentState.position=t;for(var e=0,i=this.listeners.length;e<i;e++){var n=this.listeners[e];n.onSpringUpdate&&n.onSpringUpdate(this)}return this},O.prototype.setAtRest=function(){return this._endValue=this._currentState.position,this._tempState.position=this._currentState.position,this._currentState.velocity=0,this},O.prototype.setOvershootClampingEnabled=function(t){return this._overshootClampingEnabled=t,this},O.prototype.isOvershooting=function(){var t=this._startValue,e=this._endValue;return this._springConfig.tension>0&&(t<e&&this.getCurrentValue()>e||t>e&&this.getCurrentValue()<e)},O.prototype.advance=function(t,e){var i=this.isAtRest();if(!i||!this._wasAtRest){var n=e;e>.064&&(n=.064),this._timeAccumulator+=n;for(var r,o,s,a,p,l,c=this._springConfig.tension,u=this._springConfig.friction,d=this._currentState.position,f=this._currentState.velocity,h=this._tempState.position,g=this._tempState.velocity;this._timeAccumulator>=.001;)this._timeAccumulator-=.001,this._timeAccumulator<.001&&(this._previousState.position=d,this._previousState.velocity=f),o=c*(this._endValue-h)-u*f,a=c*(this._endValue-(h=d+.001*(r=f)*.5))-u*(g=f+.001*o*.5),l=c*(this._endValue-(h=d+.001*(s=g)*.5))-u*(g=f+.001*a*.5),h=d+.001*(p=g),d+=1/6*(r+2*(s+p)+(g=f+.001*l))*.001,f+=1/6*(o+2*(a+l)+(c*(this._endValue-h)-u*g))*.001;this._tempState.position=h,this._tempState.velocity=g,this._currentState.position=d,this._currentState.velocity=f,this._timeAccumulator>0&&this._interpolate(this._timeAccumulator/.001),(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting())&&(this._springConfig.tension>0?(this._startValue=this._endValue,this._currentState.position=this._endValue):(this._endValue=this._currentState.position,this._startValue=this._endValue),this.setVelocity(0),i=!0);var m=!1;this._wasAtRest&&(this._wasAtRest=!1,m=!0);var v=!1;i&&(this._wasAtRest=!0,v=!0),this.notifyPositionUpdated(m,v)}},O.prototype.notifyPositionUpdated=function(t,e){var i=this;this.listeners.filter(Boolean).forEach(function(n){t&&n.onSpringActivate&&!i._onActivateCalled&&(n.onSpringActivate(i),i._onActivateCalled=!0),n.onSpringUpdate&&n.onSpringUpdate(i),e&&n.onSpringAtRest&&n.onSpringAtRest(i)})},O.prototype.systemShouldAdvance=function(){return!this.isAtRest()||!this.wasAtRest()},O.prototype.wasAtRest=function(){return this._wasAtRest},O.prototype.isAtRest=function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&(this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold||0===this._springConfig.tension)},O.prototype._interpolate=function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t),this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t)},O.prototype.addListener=function(t){return this.listeners.push(t),this},O.prototype.addOneTimeListener=function(t){var e=this;return Object.keys(t).forEach(function(i){var n;t[i]=(n=t[i],function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];n.apply(void 0,i),e.removeListener(t)})}),this.listeners.push(t),this},O.prototype.removeListener=function(t){return w(this.listeners,t),this};var x=function(t){this.looper=t||new C,this.looper.springSystem=this,this.listeners=[],this._activeSprings=[],this._idleSpringIndices=[],this._isIdle=!0,this._lastTimeMillis=-1,this._springRegistry={}};x.prototype.createSpring=function(t,e){return this.createSpringWithConfig({tension:t,friction:e})},x.prototype.createSpringWithConfig=function(t){var e=new O(this);return this.registerSpring(e),e.setSpringConfig(t),e},x.prototype.getIsIdle=function(){return this._isIdle},x.prototype.registerSpring=function(t){this._springRegistry[t.getId()]=t},x.prototype.deregisterSpring=function(t){w(this._activeSprings,t),delete this._springRegistry[t.getId()]},x.prototype.advance=function(t,e){for(var i=this;this._idleSpringIndices.length>0;)this._idleSpringIndices.pop();for(this._activeSprings.filter(Boolean).forEach(function(n){n.systemShouldAdvance()?n.advance(t/1e3,e/1e3):i._idleSpringIndices.push(i._activeSprings.indexOf(n))});this._idleSpringIndices.length>0;){var n=this._idleSpringIndices.pop();n>=0&&this._activeSprings.splice(n,1)}},x.prototype.loop=function(t){var e;-1===this._lastTimeMillis&&(this._lastTimeMillis=t-1);var i=t-this._lastTimeMillis;this._lastTimeMillis=t;var n=0,r=this.listeners.length;for(n=0;n<r;n++)(e=this.listeners[n]).onBeforeIntegrate&&e.onBeforeIntegrate(this);for(this.advance(t,i),0===this._activeSprings.length&&(this._isIdle=!0,this._lastTimeMillis=-1),n=0;n<r;n++)(e=this.listeners[n]).onAfterIntegrate&&e.onAfterIntegrate(this);this._isIdle||this.looper.run()},x.prototype.activateSpring=function(t){var e=this._springRegistry[t];-1===this._activeSprings.indexOf(e)&&this._activeSprings.push(e),this.getIsIdle()&&(this._isIdle=!1,this.looper.run())};var P=new x,F=function(t){var e=t.springConfig,i=e.overshootClamping,n=t.getOnUpdateFunc,r=t.onAnimationEnd,o=t.isGestureControlled,s=t.onSpringActivate,a=P.createSpring(e.stiffness,e.damping);a.setOvershootClampingEnabled(!!i);var p={onSpringActivate:s,onSpringAtRest:o?function(){}:function(){a.destroy(),r()},onSpringUpdate:n({spring:a,onAnimationEnd:r})};return a.addListener(p),a},D=function(t){var e=F(t);return e.setEndValue(1),e},U=function(t,e,i){if(void 0===e&&(e={}),t&&t.length){e.reverse&&t.reverse();var n,r="number"!=typeof(n=e.speed)?1.1:1+Math.min(Math.max(5*n,0),5),o=1/Math.max(Math.min(t.length,100),10),s=t.map(function(t,e){var n=t.getOnUpdateFunc;return t.getOnUpdateFunc=function(t){var a=n(t);return function(t){var n=t.getCurrentValue();((n=n<.01?0:n>.99?1:n)>=o||i)&&s[e+1]&&s[e+1](Math.max(Math.min(n*r,1),0)),a(t)}},t}).map(function(t){var e=F(Object.assign({},t,{isGestureControlled:i}));if(e)return e.setEndValue.bind(e)}).filter(Boolean);s[0]&&!i&&s[0](1)}},V=function(t){return[0,1,4,5,12,13].map(function(e){return t[e]})},j=function(t){return t.top<window.innerHeight&&t.bottom>0&&t.left<window.innerWidth&&t.right>0},M=function(t,e){var i;return g(t,((i={})[e[0]]=e[1],i))},R=function(t,e){return h(e?document.querySelectorAll('[data-portal-key="'+e+'"]'):t.querySelectorAll("[data-flip-id]"))},k=function(t){return t.map(function(t){return[t,t.getBoundingClientRect()]})},T={event:void 0,target:void 0,time:void 0,xy:[0,0],delta:[0,0],initial:[0,0],previous:[0,0],local:[0,0],lastLocal:[0,0],velocity:0,distance:0,down:!1,first:!0},G={window:window,touchOnly:!1,onDown:void 0,onUp:void 0},L=function(t){return function(e){var i=e.inProgressAnimations,n=e.onFinished,r=e.velocity;void 0===r&&(r=1);var o=Object.keys(i).map(function(e){var n=i[e],o=n.spring,s=n.onAnimationEnd;return o?(Object.keys(o._cachedSpringConfig).length&&o.setSpringConfig(o._cachedSpringConfig),o.setVelocity(Math.max(Math.min(r,15),2)).setEndValue(t),new Promise(function(n,r){o.addOneTimeListener({onSpringAtRest:function(o){if(o.getCurrentValue()!==t)return r();n(),1===t&&s(),function(t,e){t[e]&&t[e].spring&&t[e].spring.destroy(),delete t[e]}(i,e)}})})):Promise.reject()});Promise.all(o).then(n)}},K=L(1),B=L(0),X=function(t){this.props=t,this.flipInitiatorData=void 0,this.isFinishing=!1,this.prevProps={};var e=function(t){var e,i,n,r,o,s,a,p,l,c,u=T;return e=function(t){return u=t(u)},i={onAction:t.onAction,config:Object.assign(G,t.config)},n=i.onAction,o=function(t){e(function(e){var i=Object.assign({},e,{down:!1,first:!1});return n&&n(i),r.onUp&&r.onUp(i),Object.assign({},i,{event:t,lastLocal:e.local})})},s=function(t){var i=t.touches?t.touches[0]:t,r=i.pageX,o=i.pageY;e(function(e){var i=Date.now(),s=r-e.xy[0],a=o-e.xy[1],p=r-e.initial[0],l=o-e.initial[1],c=Math.sqrt(p*p+l*l),u=Math.sqrt(s*s+a*a),d=Object.assign({},e,{event:t,time:i,xy:[r,o],delta:[p,l],local:[e.lastLocal[0]+r-e.initial[0],e.lastLocal[1]+o-e.initial[1]],velocity:u/(i-e.time),distance:c,previous:e.xy,first:!1});return n&&n(d),Object.assign({},d)})},a=function(t){t.targetTouches&&t.targetTouches.length>1||r.maxWidth&&!window.matchMedia("screen and (max-width: "+r.maxWidth+"px)")||(r.touchOnly||(r.window.addEventListener("mousemove",s,{passive:!0}),r.window.addEventListener("mouseup",l,{passive:!0})),r.window.addEventListener("touchmove",s,{passive:!0}),r.window.addEventListener("touchend",l,{passive:!0}),function(t){var i=t.touches?t.touches[0]:t,s=i.target,a=i.pageX,l=i.pageY;e(function(e){var i=e.lastLocal||T.lastLocal,c=Object.assign({},T,{event:t,target:s,lastLocal:i,local:i,xy:[a,l],initial:[a,l],previous:[a,l],down:!0,time:Date.now(),cancel:function(){p(),_(function(){return o(t)})}});return n(c),r.onDown&&r.onDown(c),Object.assign({},c)})}(t))},p=function(){r.touchOnly||(r.window.removeEventListener("mousemove",s,{passive:!0}),r.window.removeEventListener("mouseup",l,{passive:!0})),r.window.removeEventListener("touchmove",s,{passive:!0}),r.window.removeEventListener("touchend",l,{passive:!0})},l=function(t){p(),o(t)},c={},(r=i.config).touchOnly||(c.onMouseDown=a),c.onTouchStart=a,{handlers:c,set:e}}({onAction:this.onAction.bind(this),config:this.props}),i=e.set;this.handlers=e.handlers,this.set=i};X.prototype.onAction=function(t){var e=this,i=t.velocity,n=t.delta,r=n[0],o=n[1],s=t.down,a=t.first;if(!(this.isFinishing||a&&r+o===0)){var p=this.props,l=p.inProgressAnimations,c=p.setIsGestureInitiated,u=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(i[n]=t[n]);return i}(p,["inProgressAnimations","setIsGestureInitiated"]),d=String(this.props.flipId);if(l&&c){var f=Boolean(Object.keys(l).length),h=function(){e.flipInitiatorData&&e.flipInitiatorData.cancelFlip({props:e.props,prevProps:e.prevProps}),delete e.flipInitiatorData,e.isFinishing=!1},g=["left","right","up","down"].map(function(t){return u[t]?Object.assign({direction:t,threshold:e.props.threshold||.15},u[t]):null}).filter(Boolean),m=function(t,e){return Math.abs(t)>Math.abs(e)?t>0?"right":"left":e>0?"down":"up"}(r,o),v=g.filter(function(t){return t.direction===m})[0];if(!f){if(!v)return;return function(t){e.flipInitiatorData=Object.assign({},t),e.set(function(t){return Object.assign({},t,{initial:t.xy})}),c(!0),t.initFlip({props:e.props,prevProps:e.prevProps}),setTimeout(function(){l[d]?Object.keys(l).forEach(function(t){d&&(l[t].flipInitiator=d)}):delete e.flipInitiatorData},0)}(v)}if(this.flipInitiatorData){var y=function(){e.isFinishing=!0,B({velocity:i,inProgressAnimations:l,onFinished:h})};if(this.flipInitiatorData.direction!==m&&f&&!s)return y();var S=function(t){var e=t.deltaX,i=t.deltaY;return{up:-i,down:i,left:-e,right:e}[t.direction]}({deltaX:r,deltaY:o,direction:this.flipInitiatorData.direction});if(S<=0&&!a)return h();var _=l[d].difference,E=_.translateXDifference,I=_.translateYDifference,w=_.prevRect,C=_.currentRect,b=S/Math.abs(["up","down"].indexOf(this.flipInitiatorData.direction)>-1?C.height-w.height+I:C.width-C.width+E);return!s&&b<this.flipInitiatorData.threshold?y():b>this.flipInitiatorData.threshold?(this.isFinishing=!0,K({velocity:i,inProgressAnimations:l,onFinished:function(){delete e.flipInitiatorData,delete e.isFinishing}})):void function(t){var e=t.inProgressAnimations,i=t.percentage;Object.keys(e).forEach(function(t){var n=e[t].spring;Object.keys(n._cachedSpringConfig).length||(e[t].spring._cachedSpringConfig=e[t].spring._springConfig),n.setSpringConfig({tension:300,friction:26}),e[t].spring.setEndValue(i)})}({percentage:b,inProgressAnimations:l})}}}};var Y=new x,q=function(t){var e=t.values,i=t.onUpdate,n=t.delay;void 0===n&&(n=0);var r=t.onComplete,o=g({},y.noWobble,S(t.config)),s=o.overshootClamping,a=Y.createSpring(o.stiffness,o.damping);return a.setOvershootClampingEnabled(!!s),a.addListener({onSpringAtRest:function(t){r&&r(),t.destroy()},onSpringUpdate:function(t){var n=t.getCurrentValue();if(!e)return i(n);var r=Object.keys(e).map(function(t){return[t,v(e[t][0],e[t][1],n)]}).reduce(function(t,e){var i;return Object.assign(t,((i={})[e[0]]=e[1],i))},{});i(r)}}),n?setTimeout(function(){a.setEndValue(1)},n):a.setEndValue(1),a},W=a({}),H=a("portal"),N=a({}),J=function(a){function p(){var t=this;a.apply(this,arguments),this.isGestureControlled=!1,this.isGestureInitiated=!1,this.inProgressAnimations={},this.flipCallbacks={},this.el=void 0,this.setIsGestureInitiated=function(){t.isGestureInitiated=!0}}return a&&(p.__proto__=a),(p.prototype=Object.create(a&&a.prototype)).constructor=p,p.prototype.getSnapshotBeforeUpdate=function(t){return this.isGestureInitiated?(this.isGestureControlled=!0,this.isGestureInitiated=!1):this.isGestureControlled=!1,t.flipKey!==this.props.flipKey&&this.el?function(t){var e=t.element,i=t.flipCallbacks;void 0===i&&(i={});var n=t.inProgressAnimations;void 0===n&&(n={});var r=R(e,t.portalKey),o=h(e.querySelectorAll("[data-inverse-flip-id]")),s={},a=[],p={};r.filter(function(t){return i&&i[t.dataset.flipId]&&i[t.dataset.flipId].onExit}).forEach(function(t){var e=t.parentNode;if(t.closest){var i=t.closest("[data-exit-container]");i&&(e=i)}var n=a.findIndex(function(t){return t[0]===e});-1===n&&(a.push([e,e.getBoundingClientRect()]),n=a.length-1),s[t.dataset.flipId]=a[n][1],p[t.dataset.flipId]=e});var l=k(r),c=l.map(function(t){var e=t[0],n=t[1],r={};if(i&&i[e.dataset.flipId]&&i[e.dataset.flipId].onExit){var o=s[e.dataset.flipId];g(r,{element:e,parent:p[e.dataset.flipId],childPosition:{top:n.top-o.top,left:n.left-o.left,width:n.width,height:n.height}})}return[e.dataset.flipId,{rect:n,opacity:parseFloat(window.getComputedStyle(e).opacity||"1"),domDataForExitAnimations:r}]}).reduce(M,{});return function(t,e){Object.keys(t).forEach(function(e){t[e].spring&&t[e].spring.destroy(),delete t[e]}),e.forEach(function(t){t.style.transform="",t.style.opacity=""})}(n,r.concat(o)),{flippedElementPositions:c,cachedOrderedFlipIds:l.map(function(t){return t[0].dataset.flipId})}}({element:this.el,flipCallbacks:this.flipCallbacks,inProgressAnimations:this.inProgressAnimations,portalKey:this.props.portalKey}):null},p.prototype.componentDidUpdate=function(s,a,p){this.props.flipKey!==s.flipKey&&this.el&&function(s){var a=s.cachedOrderedFlipIds;void 0===a&&(a=[]);var p=s.inProgressAnimations;void 0===p&&(p={});var l=s.flippedElementPositionsBeforeUpdate;void 0===l&&(l={});var c=s.flipCallbacks;void 0===c&&(c={});var u=s.containerEl,f=s.applyTransformOrigin,m=s.spring,_=s.debug,E=s.portalKey,I=s.staggerConfig;void 0===I&&(I={});var w=s.decisionData;void 0===w&&(w={});var C=s.handleEnterUpdateDelete,b=s.isGestureControlled,A=s.onComplete,O=s.onStart,x=function(t){return k(R(t.element,t.portalKey)).map(function(t){var e=t[0],i=t[1],n=window.getComputedStyle(e);return[e.dataset.flipId,{element:e,rect:i,opacity:parseFloat(n.opacity),transform:n.transform}]}).reduce(M,{})}({element:u,portalKey:E}),P=function(t){var e=t.containerEl,i=t.portalKey;return i?function(t){return function(e){return h(document.querySelectorAll('[data-portal-key="'+t+'"]'+e))}}(i):e?function(t){var e=Math.random().toFixed(5);return t.dataset.flipperId=e,function(i){return h(t.querySelectorAll('[data-flipper-id="'+e+'"] '+i))}}(e):function(){return[]}}({containerEl:u,portalKey:E}),F=function(t){return function(e){return t('[data-flip-id="'+e+'"]')[0]}}(P),T=function(t){return l[t]&&x[t]},G=Object.keys(l).concat(Object.keys(x)).filter(function(t){return!T(t)}),L={flipCallbacks:c,getElement:F,flippedElementPositionsBeforeUpdate:l,flippedElementPositionsAfterUpdate:x,inProgressAnimations:p,decisionData:w},K=function(t){var e,i=t.unflippedIds,n=t.flipCallbacks,r=t.getElement,o=t.flippedElementPositionsBeforeUpdate,s=t.flippedElementPositionsAfterUpdate,a=t.inProgressAnimations,p=t.decisionData,l=i.filter(function(t){return s[t]}).filter(function(t){return n[t]&&n[t].onAppear}),c=i.filter(function(t){return o[t]&&n[t]&&n[t].onExit}),u=new Promise(function(t){e=t}),d=[],f=0,h=c.map(function(t,i){var r=o[t].domDataForExitAnimations,s=r.element,l=r.parent,c=r.childPosition,u=c.top,h=c.left,g=c.width,m=c.height;"static"===getComputedStyle(l).position&&(l.style.position="relative"),s.style.transform="matrix(1, 0, 0, 1, 0, 0)",s.style.position="absolute",s.style.top=u+"px",s.style.left=h+"px",s.style.height=m+"px",s.style.width=g+"px";var v=d.filter(function(t){return t[0]===l})[0];v||(v=[l,document.createDocumentFragment()],d.push(v)),v[1].appendChild(s),f+=1;var y=function(){try{l.removeChild(s)}catch(t){}finally{0==(f-=1)&&e()}};return a[t]={stop:y},function(){return n[t].onExit(s,i,y,p)}});return d.forEach(function(t){t[0].appendChild(t[1])}),h.length||e(),{hideEnteringElements:function(){l.forEach(function(t){var e=r(t);e&&(e.style.opacity="0")})},animateEnteringElements:function(){l.forEach(function(t,e){var i=r(t);i&&n[t].onAppear(i,e,p)})},animateExitingElements:function(){return h.forEach(function(t){return t()}),u}}}(g({},L,{unflippedIds:G})),B=K.hideEnteringElements,X=K.animateEnteringElements,Y=K.animateExitingElements,q=g({},L,{containerEl:u,isGestureControlled:b,flippedIds:a.filter(T),applyTransformOrigin:f,spring:m,debug:_,staggerConfig:I,scopedSelector:P,onComplete:A});O&&O(u,w);var W=function(s){var a=q.flippedIds,p=q.flipCallbacks,l=q.inProgressAnimations,c=q.flippedElementPositionsBeforeUpdate,u=q.flippedElementPositionsAfterUpdate,f=q.applyTransformOrigin,m=q.spring,_=q.getElement,E=q.debug,I=q.staggerConfig;void 0===I&&(I={});var w=q.decisionData;void 0===w&&(w={});var C,b=q.onComplete,A=q.containerEl,O=q.isGestureControlled,x=new Promise(function(t){C=t});if(b&&x.then(function(){return b(A,w)}),!a.length)return function(){return C([]),x};var P,F=[],M=_(a[0]),R=M?M.ownerDocument.querySelector("body"):document.querySelector("body");P=a.reduce(function(t,e){return t[e]=(t[e]||0)+1,t},{}),Object.keys(P).filter(function(t){return P[t]>1});var k=a.map(function(s){var a=c[s].rect,_=u[s].rect,E=c[s].opacity,I=u[s].opacity,b=_.width<1||_.height<1,A=u[s].element;if(!j(a)&&!j(_))return!1;if(!A)return!1;var x=JSON.parse(A.dataset.flipConfig),P=function(t){void 0===t&&(t={});var e=t.flippedSpring;return g({},y.noWobble,S(t.flipperSpring),S(e))}({flipperSpring:m,flippedSpring:x.spring}),D=!0===x.stagger?"default":x.stagger,U={element:A,id:s,stagger:D,springConfig:P};if(p[s]&&p[s].shouldFlip&&!p[s].shouldFlip(w.previous,w.current))return!1;var M=Math.abs(a.left-_.left),T=Math.abs(a.top-_.top),G=M+T,L=Math.abs(a.width-_.width)+Math.abs(a.height-_.height),K=Math.abs(I-E);if(G<.5&&L<.5&&K<.01)return!1;var B=t(u[s].transform),X={matrix:B},Y={matrix:[]},q=[B];x.translate&&(q.push(e(a.left-_.left)),q.push(i(a.top-_.top))),x.scale&&(q.push(n(Math.max(a.width,1)/Math.max(_.width,1))),q.push(r(Math.max(a.height,1)/Math.max(_.height,1)))),x.opacity&&(Y.opacity=E,X.opacity=I);var W=[];if(!p[s]||!p[s].shouldInvert||p[s].shouldInvert(w.previous,w.current)){var H=function(t,e){return h(t.querySelectorAll('[data-inverse-flip-id="'+e+'"]'))}(A,s);W=H.map(function(t){return[t,JSON.parse(t.dataset.flipConfig)]})}Y.matrix=V(q.reduce(o)),X.matrix=V(X.matrix);var N,J=function(t){var e=t.element,i=t.invertedChildren,n=t.body;return function(t){var r=t.matrix,o=t.opacity,s=t.forceMinVals;if(d(o)&&(e.style.opacity=o+""),s&&(e.style.minHeight="1px",e.style.minWidth="1px"),r){var a=function(t){return"matrix("+t.join(", ")+")"}(r);e.style.transform=a,i&&function(t){var e=t.matrix,i=t.body;t.invertedChildren.forEach(function(t){var n=t[0],r=t[1];if(i.contains(n)){var o=e[0],s=e[3],a=e[5],p={translateX:0,translateY:0,scaleX:1,scaleY:1},l="";r.translate&&(p.translateX=-e[4]/o,p.translateY=-a/s,l+="translate("+p.translateX+"px, "+p.translateY+"px)"),r.scale&&(p.scaleX=1/o,p.scaleY=1/s,l+=" scale("+p.scaleX+", "+p.scaleY+")"),n.style.transform=l}})}({invertedChildren:i,matrix:r,body:n})}}}({element:A,invertedChildren:W,body:R});if(p[s]&&p[s].onComplete){var z=p[s].onComplete;N=function(){return z(A,w)}}var Q=d(Y.opacity)&&d(X.opacity)&&Y.opacity!==X.opacity,Z=!1;return g({},U,{stagger:D,springConfig:P,getOnUpdateFunc:function(t){return l[s]={spring:t.spring,onAnimationEnd:t.onAnimationEnd,difference:{translateXDifference:M,translateYDifference:T,prevRect:a,currentRect:_}},function(t){p[s]&&p[s].onSpringUpdate&&p[s].onSpringUpdate(t.getCurrentValue()),Z||(Z=!0,p[s]&&p[s].onStart&&p[s].onStart(A,w));var e=t.getCurrentValue();if(R.contains(A)){var i={matrix:[]};i.matrix=Y.matrix.map(function(t,i){return v(t,X.matrix[i],e)}),Q&&(i.opacity=v(Y.opacity,X.opacity,e)),J(i)}else t.destroy()}},initializeFlip:function(){J({matrix:Y.matrix,opacity:Q?Y.opacity:void 0,forceMinVals:b}),p[s]&&p[s].onStartImmediate&&p[s].onStartImmediate(A,w),x.transformOrigin?A.style.transformOrigin=x.transformOrigin:f&&(A.style.transformOrigin="0 0"),W.forEach(function(t){var e=t[0],i=t[1];i.transformOrigin?e.style.transformOrigin=i.transformOrigin:f&&(e.style.transformOrigin="0 0")})},onAnimationEnd:function(){delete l[s],"function"==typeof N&&N(),A.style.transform="",W.forEach(function(t){t[0].style.transform=""}),b&&A&&(A.style.minHeight="",A.style.minWidth=""),F.push(s),F.length>=k.length&&C(F)},isGestureControlled:O,delayUntil:x.delayUntil})}).filter(Boolean);if(k.forEach(function(t){return(0,t.initializeFlip)()}),E)return function(){};var T=k.filter(function(t){return t.delayUntil&&(e=t.delayUntil,k.filter(function(t){return t.id===e}).length);var e}),G={},L={},K={};T.forEach(function(t){t.stagger?(K[t.stagger]=!0,L[t.delayUntil]?L[t.delayUntil].push(t.stagger):L[t.delayUntil]=[t.stagger]):G[t.delayUntil]?G[t.delayUntil].push(t):G[t.delayUntil]=[t]});var B=k.filter(function(t){return t.stagger}).reduce(function(t,e){return t[e.stagger]?t[e.stagger].push(e):t[e.stagger]=[e],t},{}),X=k.filter(function(t){return-1===T.indexOf(t)});return X.forEach(function(t){t.onSpringActivate=function(){G[t.id]&&G[t.id].forEach(D),L[t.id]&&Object.keys(L[t.id].reduce(function(t,e){var i;return g(t,((i={})[e]=!0,i))},{})).forEach(function(t){U(B[t],I[t],O)})}}),function(){return k.length||C([]),X.filter(function(t){return!t.stagger}).forEach(D),Object.keys(B).forEach(function(t){K[t]||U(B[t],I[t],O)}),x}}();C?C({hideEnteringElements:B,animateEnteringElements:X,animateExitingElements:Y,animateFlippedElements:W}):(B(),Y().then(X),W())}({flippedElementPositionsBeforeUpdate:p.flippedElementPositions,cachedOrderedFlipIds:p.cachedOrderedFlipIds,isGestureControlled:this.isGestureControlled,containerEl:this.el,inProgressAnimations:this.inProgressAnimations,flipCallbacks:this.flipCallbacks,applyTransformOrigin:this.props.applyTransformOrigin,spring:this.props.spring,debug:this.props.debug,portalKey:this.props.portalKey,staggerConfig:this.props.staggerConfig,handleEnterUpdateDelete:this.props.handleEnterUpdateDelete,decisionData:{previous:s.decisionData,current:this.props.decisionData},onComplete:this.props.onComplete,onStart:this.props.onStart})},p.prototype.render=function(){var t=this,e=this.props,i=e.portalKey,n=s.createElement(N.Provider,{value:{inProgressAnimations:this.inProgressAnimations,setIsGestureInitiated:this.setIsGestureInitiated}},s.createElement(W.Provider,{value:this.flipCallbacks},s.createElement(e.element,{className:e.className,ref:function(e){return t.el=e}},this.props.children)));return i&&(n=s.createElement(H.Provider,{value:i},n)),n},p}(p);function z(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(i[n]=t[n]);return i}J.defaultProps={applyTransformOrigin:!0,element:"div"};var Q=function(t){var e=t.children,i=t.flipId,n=t.inverseFlipId,r=t.portalKey,o=t.gestureHandlers,s=z(t,["children","flipId","inverseFlipId","portalKey","gestureHandlers"]),a=e,p=function(t){return"function"==typeof t}(a);if(!p)try{a=l.only(e)}catch(t){throw new Error("Each Flipped component must wrap a single child")}s.scale||s.translate||s.opacity||g(s,{translate:!0,scale:!0,opacity:!0});var u={};return u["data-flip-config"]=JSON.stringify(s),i?u["data-flip-id"]=String(i):n&&(u["data-inverse-flip-id"]=String(n)),r&&(u["data-portal-key"]=r),p?a(u):(o&&g(u,o),c(a,u))},Z=function(t){var e=t.children,i=t.flipId,n=t.shouldFlip,r=t.shouldInvert,o=t.onAppear,a=t.onStart,p=t.onStartImmediate,l=t.onComplete,c=t.onExit,u=t.onSpringUpdate,d=t.gestureHandlers,h=z(t,["children","flipId","shouldFlip","shouldInvert","onAppear","onStart","onStartImmediate","onComplete","onExit","onSpringUpdate","gestureHandlers"]);return e?h.inverseFlipId?s.createElement(Q,Object.assign({},h),e):s.createElement(H.Consumer,null,function(t){return s.createElement(W.Consumer,null,function(g){return f(g)&&i&&(g[i]={shouldFlip:n,shouldInvert:r,onAppear:o,onStart:a,onStartImmediate:p,onComplete:l,onExit:c,onSpringUpdate:u}),s.createElement(Q,Object.assign({flipId:i},h,{portalKey:t,gestureHandlers:d}),e)})}):null};Z.displayName="Flipped";var $=function(t){var e;return c(t.children,((e={})["data-exit-container"]=!0,e))},tt=function(t){function e(){t.apply(this,arguments),this.processProps=function(t){return Object.assign({},t,{flipId:t.flipId?String(t.flipId):String(t.children.props.flipId)})},this.swipe=new X(this.processProps(this.props))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidUpdate=function(t){this.swipe.props=this.processProps(this.props),this.swipe.prevProps=this.processProps(t)},e.prototype.render=function(){return s.Children.only(this.props.children),c(this.props.children,"Flipped"===this.props.children.type.displayName?{gestureHandlers:this.swipe.handlers}:this.swipe.handlers)},e}(p);function et(t){return s.createElement(N.Consumer,null,function(e){return s.createElement(tt,Object.assign({inProgressAnimations:e.inProgressAnimations,setIsGestureInitiated:e.setIsGestureInitiated},t))})}export{J as Flipper,Z as Flipped,$ as ExitContainer,et as Swipe,q as spring};
//# sourceMappingURL=index.es.js.map
